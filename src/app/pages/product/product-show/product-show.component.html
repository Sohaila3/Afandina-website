<section class="product_show" itemscope itemtype="https://schema.org/Product">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-7">
        <div class="product_details mt-3">
          <p-galleria
            [value]="images"
            [showItemNavigators]="true"
            [responsiveOptions]="responsiveOptions"
            [circular]="true"
            [numVisible]="6"
            [containerStyle]="{ width: '100%' }"
          >
            <ng-template pTemplate="item" let-item let-i="index">
              <div class="gallery-item-wrapper" (click)="openFullScreen(i)">
                <img
                  itemprop="image"
                  [src]="
                    'https://admin.afandinacarrental.com/storage/' +
                    item.file_path
                  "
                  class="full-width-image"
                  [alt]="generateOptimizedH1() + ' - Image ' + (i + 1)"
                  [title]="generateOptimizedH1() + ' - Image ' + (i + 1)"
                  loading="lazy"
                  width="800"
                  height="600"
                />
                <div class="image-overlay">
                  <i class="fa-solid fa-expand"></i>
                </div>
              </div>
            </ng-template>
            <ng-template pTemplate="thumbnail" let-item let-idx="index">
              <div class="grid grid-nogutter">
                <img
                  [src]="
                    'https://admin.afandinacarrental.com/storage/' +
                    item.file_path
                  "
                  style="
                    display: block;
                    height: auto;
                    max-height: 70px;
                    object-fit: cover;
                    width: 120px;
                    border-radius: 7px;
                  "
                  [alt]="generateOptimizedH1() + ' thumbnail ' + (idx + 1)"
                  [title]="generateOptimizedH1() + ' thumbnail ' + (idx + 1)"
                  loading="lazy"
                  width="120"
                  height="70"
                />
              </div>
            </ng-template>
          </p-galleria>
        </div>
      </div>

      <div class="col-lg-5 mt-3">
        <div class="card_details mb-3">
          <p-card [style]="{ width: '100%' }" class="card_product">
            <div class="d-flex align-items-center title mb-3">
              <h1 itemprop="name" class="m-0 product-title">
                {{ generateOptimizedH1() }}
              </h1>
              <!-- Hidden full name for schema -->
              <meta
                itemprop="description"
                [content]="
                  getFullProductName() +
                  ' - ' +
                  (productDetails?.data?.description || '')
                "
              />
              <meta
                itemprop="brand"
                [content]="productDetails?.data?.brand || ''"
              />
              <meta
                itemprop="model"
                [content]="productDetails?.data?.car_model || ''"
              />
              <meta
                itemprop="productionDate"
                [content]="productDetails?.data?.year || ''"
              />
              <meta
                itemprop="category"
                [content]="productDetails?.data?.category || ''"
              />
            </div>

            <p
              class="small_description three-lines ellipse mb-3"
              itemprop="description"
            >
              {{ productDetails?.data?.description }}
            </p>

            <div class="d-flex align-items-center car_details mb-2">
              <div>
                <i class="fa-solid fa-user" aria-hidden="true"></i>
                <span class="mx-1">{{
                  productDetails?.data?.passenger_capacity
                }}</span>
                <span class="sr-only"
                  >{{
                    productDetails?.data?.passenger_capacity
                  }}
                  passengers</span
                >
              </div>
              <div class="mx-3">
                <img
                  src="../../../../assets/images/icon/Window.svg"
                  class="mx-1"
                  [alt]="'Door Count: ' + productDetails?.data?.door_count"
                  [title]="'Door Count: ' + productDetails?.data?.door_count"
                  width="18"
                  height="18"
                />
                <span class="mx-1">{{ productDetails?.data?.door_count }}</span>
              </div>
              <div>
                <img
                  src="../../../../assets/images/icon/car.svg"
                  class="mx-1"
                  [alt]="'Category: ' + productDetails?.data?.category"
                  [title]="'Category: ' + productDetails?.data?.category"
                  width="18"
                  height="18"
                />
                <span class="mx-1">{{ productDetails?.data?.category }}</span>
              </div>
            </div>

            <hr />

            <div class="carOverview">
              <h2 class="section-title">{{ translations["car_over_view"] }}</h2>
              <div class="d-flex align-items-center flex-wrap">
                <div class="carOverviewCard">
                  <h3 class="card-label">{{ translations["category"] }}</h3>
                  <p>
                    <a
                      [routerLink]="[
                        '/',
                        currentLang,
                        'category',
                        productDetails?.data?.category_slug
                      ]"
                      class="car-detail-link"
                      [title]="
                        'Browse ' + productDetails?.data?.category + ' cars'
                      "
                      [attr.aria-label]="
                        'Browse ' + productDetails?.data?.category + ' category'
                      "
                      >{{ productDetails?.data?.category || "-" }}</a
                    >
                  </p>
                </div>

                <div class="carOverviewCard">
                  <h3 class="card-label">{{ translations["brand"] }}</h3>
                  <p
                    itemprop="brand"
                    itemscope
                    itemtype="https://schema.org/Brand"
                  >
                    <a
                      itemprop="name"
                      [routerLink]="[
                        '/',
                        currentLang,
                        'brand',
                        productDetails?.data?.brand_slug
                      ]"
                      class="car-detail-link"
                      [title]="
                        'Browse ' + productDetails?.data?.brand + ' cars'
                      "
                      [attr.aria-label]="
                        'Browse ' + productDetails?.data?.brand + ' brand'
                      "
                      >{{ productDetails?.data?.brand || "-" }}</a
                    >
                  </p>
                </div>

                <div class="carOverviewCard">
                  <h3 class="card-label">{{ translations["model"] }}</h3>
                  <p itemprop="model">
                    {{ productDetails?.data?.car_model || "-" }}
                  </p>
                </div>

                <div class="carOverviewCard">
                  <h3 class="card-label">{{ translations["year"] }}</h3>
                  <p itemprop="productionDate">
                    {{ productDetails?.data?.year || "-" }}
                  </p>
                </div>

                <div class="carOverviewCard">
                  <h3 class="card-label">{{ translations["color"] }}</h3>
                  <span
                    [style.background-color]="productDetails?.data?.color?.code"
                    [attr.aria-label]="
                      'Color: ' +
                      (productDetails?.data?.color?.name || 'Unknown')
                    "
                  ></span>
                </div>
              </div>
            </div>

            <hr />

            <div
              class="price mb-2"
              itemprop="offers"
              itemscope
              itemtype="https://schema.org/AggregateOffer"
            >
              <h2 class="section-title">{{ translations["Pricing"] }}</h2>
              <meta itemprop="priceCurrency" content="AED" />
              <meta
                itemprop="availability"
                content="https://schema.org/InStock"
              />

              <div class="row">
                <div class="col-6">
                  <div class="day">
                    <p class="price-value">
                      <span itemprop="lowPrice">{{
                        productDetails?.data?.daily_discount_price
                      }}</span>
                      <span class="old_price">{{
                        productDetails?.data?.daily_main_price
                      }}</span>
                      <span class="price-label"
                        >AED\{{ translations["per_day"] }}</span
                      >
                    </p>
                  </div>
                </div>
                <div class="col-6">
                  <div class="month">
                    <p class="price-value">
                      <span itemprop="highPrice">{{
                        productDetails?.data?.monthly_discount_price
                      }}</span>
                      <span class="old_price">{{
                        productDetails?.data?.monthly_main_price
                      }}</span>
                      <span class="price-label"
                        >AED\{{ translations["per_month"] }}</span
                      >
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="message row mb-2">
              <div
                class="col-6"
                *ngIf="productDetails?.data?.free_delivery == '1'"
              >
                <div class="d-flex align-items-center feature-item">
                  <img
                    src="../../../../assets/images/icon/check.svg"
                    [alt]="translations['free_delivery']"
                    [title]="translations['free_delivery']"
                    width="16"
                    height="16"
                  />
                  <p class="mx-1">{{ translations["free_delivery"] }}</p>
                </div>
              </div>
              <div
                class="col-6"
                *ngIf="productDetails?.data?.insurance_included == '1'"
              >
                <div class="d-flex align-items-center feature-item">
                  <img
                    src="../../../../assets/images/icon/check.svg"
                    [alt]="translations['insurance_included']"
                    [title]="translations['insurance_included']"
                    width="16"
                    height="16"
                  />
                  <p class="mx-1">{{ translations["insurance_included"] }}</p>
                </div>
              </div>
              <div class="col-6">
                <div
                  class="d-flex align-items-center mb-1 feature-item"
                  *ngIf="productDetails?.data?.insurance_included == '1'"
                >
                  <i class="fa-solid fa-bitcoin-sign" aria-hidden="true"></i>
                  <p class="mx-1">
                    {{ translations["crypto_payment_accepted"] }}
                  </p>
                </div>
              </div>
            </div>

            <ng-template pTemplate="footer">
              <div class="row">
                <div class="col-6 p-1">
                  <a
                    [href]="whatsappUrl"
                    class="whatsapp action-btn"
                    [title]="translations['whatsapp']"
                    [attr.aria-label]="translations['whatsapp']"
                    rel="noopener noreferrer"
                    target="_blank"
                  >
                    <i class="fa-brands fa-whatsapp" aria-hidden="true"></i>
                    <span class="mx-1">{{ translations["whatsapp"] }}</span>
                  </a>
                </div>
                <div class="col-6 p-1">
                  <a
                    [href]="'tel:' + contactData.phone"
                    class="call_us action-btn"
                    [title]="translations['call_us']"
                    [attr.aria-label]="translations['call_us']"
                  >
                    <i class="fa-solid fa-phone" aria-hidden="true"></i>
                    <span class="mx-1">{{ translations["call_us"] }}</span>
                  </a>
                </div>
              </div>
            </ng-template>
          </p-card>
        </div>
      </div>

      <div
        class="col-lg-7 order_description"
        *ngIf="productDetails?.data?.long_description"
      >
        <div class="product_details border-0">
          <div class="description rich-text-content mb-3">
            <div
              class="description-header d-flex align-items-start justify-content-between"
            >
              <h2 class="description-title">
                {{ translations["car_description"] }}
              </h2>

              <button
                type="button"
                class="read-more-btn"
                (click)="toggleDescription(); $event.stopPropagation()"
                [attr.aria-expanded]="isDescriptionExpanded"
                [attr.aria-label]="
                  isDescriptionExpanded
                    ? translations['show_less'] || 'Show less'
                    : translations['show_more'] || 'Show more'
                "
                aria-controls="product-long-description"
              >
                <span class="label">
                  {{
                    isDescriptionExpanded
                      ? translations["show_less"] || "Show less"
                      : translations["show_more"] || "Show more"
                  }}
                </span>
                <i class="fa-solid fa-chevron-down icon" aria-hidden="true"></i>
              </button>
            </div>

            <!-- Collapsible description: shows a trimmed area when collapsed -->
            <div
              id="product-long-description"
              class="description-wrapper"
              [ngStyle]="{
                'max-height': isDescriptionExpanded ? 'none' : '220px',
                overflow: isDescriptionExpanded ? 'visible' : 'hidden'
              }"
              [attr.aria-expanded]="isDescriptionExpanded"
              role="region"
            >
              <div
                class="description rich-text-content"
                [innerHTML]="productDetails?.data?.long_description"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-5 careatures order_carOverview">
        <div
          class="product_details border-0"
          *ngIf="
            productDetails?.data?.car_features &&
            productDetails?.data?.car_features.length > 0
          "
        >
          <div class="carOverview">
            <h2 class="section-title">{{ translations["car_features"] }}</h2>
            <div class="row">
              <div
                class="col-lg-3 col-md-4 col-sm-4 col-4 p-1"
                *ngFor="
                  let feature of productDetails?.data?.car_features;
                  let i = index
                "
              >
                <div class="carOverviewCard">
                  <img
                    src="../../../../assets/images/icon/check.svg"
                    class="mb-2"
                    width="25"
                    height="25"
                    [alt]="feature.name + ' feature'"
                    [title]="feature.name"
                    loading="lazy"
                  />
                  <p>{{ feature.name }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Full Screen Gallery Modal -->
<div
  class="fullscreen-gallery"
  *ngIf="isFullScreen"
  (click)="closeFullScreen()"
  role="dialog"
  aria-modal="true"
  [attr.aria-label]="
    'Image gallery - ' +
    (currentImageIndex + 1) +
    ' of ' +
    (images?.length || 0)
  "
>
  <button
    class="close-btn"
    (click)="closeFullScreen()"
    [attr.aria-label]="'Close gallery'"
    type="button"
  >
    <i class="fa-solid fa-times" aria-hidden="true"></i>
  </button>

  <button
    class="nav-btn prev-btn"
    (click)="previousImage(); $event.stopPropagation()"
    [attr.aria-label]="'Previous image'"
    type="button"
  >
    <i class="fa-solid fa-chevron-left" aria-hidden="true"></i>
  </button>

  <div class="fullscreen-image-container" (click)="$event.stopPropagation()">
    <img
      *ngIf="images && images[currentImageIndex]"
      [src]="
        'https://admin.afandinacarrental.com/storage/' +
        images[currentImageIndex].file_path
      "
      [alt]="
        generateOptimizedH1() +
        ' - Full screen image ' +
        (currentImageIndex + 1)
      "
      class="fullscreen-image"
    />
    <div class="image-counter" aria-live="polite">
      {{ currentImageIndex + 1 }} / {{ images?.length }}
    </div>
  </div>

  <button
    class="nav-btn next-btn"
    (click)="nextImage(); $event.stopPropagation()"
    [attr.aria-label]="'Next image'"
    type="button"
  >
    <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
  </button>

  <div class="thumbnail-strip" (click)="$event.stopPropagation()">
    <img
      *ngFor="let img of images; let i = index"
      [src]="'https://admin.afandinacarrental.com/storage/' + img.file_path"
      [alt]="generateOptimizedH1() + ' thumbnail ' + (i + 1)"
      [class.active]="i === currentImageIndex"
      (click)="currentImageIndex = i"
      loading="lazy"
      width="60"
      height="60"
      [attr.aria-label]="'Go to image ' + (i + 1)"
      tabindex="0"
      (keydown.enter)="currentImageIndex = i"
      (keydown.space)="currentImageIndex = i; $event.preventDefault()"
    />
  </div>
</div>

<section
  class="related_blogs p-3 px-0"
  *ngIf="(productDetails?.data?.related_cars?.length || 0) > 0"
>
  <div class="container-fluid">
    <div class="related_blogs_head mb-3">
      <h2 class="section-title">{{ translations["related_cars"] }}</h2>
    </div>

    <swiper
      class="mx-2"
      #onlyOnAfandina
      [slidesPerView]="4.5"
      [spaceBetween]="0"
      [navigation]="false"
      [breakpoints]="swiperCard.breakpoints"
      class="mySwiper"
      role="list"
      [attr.aria-label]="translations['related_cars']"
    >
      <ng-template
        swiperSlide
        *ngFor="let car of productDetails?.data?.related_cars; let i = index"
        role="listitem"
      >
        <app-product-card [carData]="car"></app-product-card>
      </ng-template>
    </swiper>
  </div>
</section>
